{"version":3,"file":"index.mjs","sources":["../../src/vitepress/utils/vitepress/locales.ts","../../src/vitepress/utils/vitepress/sidebar.ts","../../src/vitepress/utils/task.ts","../../src/vitepress/utils/emoji.ts","../../src/vitepress/utils/svg/escape.ts","../../src/vitepress/utils/svg/render.ts","../../src/vitepress/index.ts"],"sourcesContent":["import type { DefaultTheme, SiteData } from 'vitepress'\n\nexport function getLocales(siteData: SiteData<DefaultTheme.Config>) {\n  const locales: string[] = []\n  locales.push(siteData.lang ?? 'root')\n\n  if (Object.keys(siteData.locales).length === 0)\n    return locales\n\n  for (const locale in siteData.locales) {\n    if (locale !== siteData.lang)\n      locales.push(locale)\n  }\n\n  return locales\n}\n\nexport function getTitleWithLocales(siteData: SiteData<DefaultTheme.Config>, locale: string): string {\n  if (Object.keys(siteData.locales).length > 0) {\n    const title = siteData.locales[locale]?.title\n    if (title)\n      return title\n    if (siteData.locales.root.title)\n      return siteData.locales.root.title\n    return siteData.title\n  }\n\n  return siteData.title\n}\n\nexport function getDescriptionWithLocales(siteData: SiteData<DefaultTheme.Config>, locale: string): string {\n  if (Object.keys(siteData.locales).length > 0) {\n    const description = siteData.locales[locale]?.description\n    if (description)\n      return description\n    if (siteData.locales.root.description)\n      return siteData.locales.root.description\n    return siteData.description\n  }\n\n  return siteData.description\n}\n","import type { DefaultTheme, SiteData } from 'vitepress'\nimport { getLocales } from './locales'\n\ninterface AggregatedSidebar {\n  defaultLocale: string\n  locales: string[]\n  sidebar: Record<string, DefaultTheme.SidebarItem[]>\n}\n\n/**\n * Search for available sidebars in both the default locale and other locales over the site data and theme config.\n *\n * @param {SiteConfig<DefaultTheme.Config>} siteData Site data\n * @param {DefaultTheme.Config} themeConfig Theme config\n * @returns {AggregatedSidebar} Aggregated sidebar\n */\nexport function getSidebar(siteData: SiteData<DefaultTheme.Config>, themeConfig: DefaultTheme.Config): AggregatedSidebar {\n  const locales = getLocales(siteData)\n\n  if (locales.length === 0) {\n    return {\n      defaultLocale: siteData.lang,\n      locales: locales || [],\n      sidebar: {\n        [siteData.lang]: flattenThemeConfigSidebar(themeConfig.sidebar) || [],\n      },\n    }\n  }\n\n  const sidebar: AggregatedSidebar = {\n    defaultLocale: siteData.lang,\n    locales,\n    sidebar: {},\n  }\n\n  for (const locale of locales) {\n    let themeConfigSidebar: DefaultTheme.Sidebar = []\n    if (typeof siteData.locales[locale]?.themeConfig?.sidebar !== 'undefined')\n      themeConfigSidebar = siteData.locales[locale]?.themeConfig?.sidebar || []\n    else if (typeof siteData.themeConfig?.sidebar !== 'undefined')\n      themeConfigSidebar = siteData.themeConfig?.sidebar || []\n    else if (typeof themeConfig.sidebar !== 'undefined')\n      themeConfigSidebar = themeConfig.sidebar\n    else\n      themeConfigSidebar = []\n\n    sidebar.sidebar[locale] = flattenThemeConfigSidebar(themeConfigSidebar) || []\n  }\n\n  return sidebar\n}\n\n/**\n * Since sidebar is possible to be either items or multi-sidebars, we need to flatten it to a single array.\n * @param {DefaultTheme.Sidebar} sidebar\n * @returns {DefaultTheme.Sidebar} Flattened sidebar\n */\nfunction flattenThemeConfigSidebar(sidebar?: DefaultTheme.Sidebar): DefaultTheme.SidebarItem[] {\n  if (!sidebar)\n    return []\n\n  if (Array.isArray(sidebar))\n    return sidebar\n\n  return Object.keys(sidebar).reduce((prev, curr) => {\n    const items = sidebar[curr]\n    return prev.concat(items)\n  }, [] as DefaultTheme.SidebarItem[])\n}\n\nexport function flattenSidebar(sidebar: DefaultTheme.SidebarItem[]): DefaultTheme.SidebarItem[] {\n  return sidebar.reduce((prev, curr) => {\n    if (curr.items)\n      return prev.concat(flattenSidebar(curr.items))\n\n    return prev.concat(curr)\n  }, [] as DefaultTheme.SidebarItem[])\n}\n","// vitepress/src/node/utils/task.ts at df8753bd927c2b57b9188fb292c1429e9c3c8ab6 · vuejs/vitepress\n// https://github.com/vuejs/vitepress/blob/df8753bd927c2b57b9188fb292c1429e9c3c8ab6/src/node/utils/task.ts\n\nimport { relative } from 'node:path'\nimport ora from 'ora'\nimport { cyan, gray, green, red, yellow } from 'colorette'\nimport type { SiteConfig } from 'vitepress'\n\ninterface TaskResultSuccess {\n  status: 'success'\n  filePath: string\n}\n\ninterface TaskResultSkipped {\n  status: 'skipped'\n  reason: string\n  filePath: string\n}\n\ninterface TaskResultErrored {\n  status: 'errored'\n  reason: string\n  filePath: string\n}\n\nexport type TaskResult = TaskResultSuccess | TaskResultSkipped | TaskResultErrored\n\nexport const okMark = green('✓')\nexport const failMark = red('✖')\n\nexport async function task(taskName: string, task: () => Promise<string | undefined>) {\n  const startsAt = Date.now()\n\n  const moduleNamePrefix = cyan('@nolebase/vitepress-plugin-og-image')\n  const grayPrefix = gray(':')\n  const spinnerPrefix = `${moduleNamePrefix}${grayPrefix}`\n\n  const spinner = ora({ discardStdin: false })\n  spinner.start(`${spinnerPrefix} ${taskName}...`)\n\n  let result: string | undefined\n\n  try {\n    result = await task()\n  }\n  catch (e) {\n    spinner.stopAndPersist({ symbol: failMark })\n    throw e\n  }\n\n  const elapsed = Date.now() - startsAt\n  const suffixText = `${gray(`(${elapsed}ms)`)} ${result}` ?? ''\n\n  spinner.stopAndPersist({ symbol: okMark, suffixText })\n}\n\nexport function renderTaskResultsSummary(results: TaskResult[], siteConfig: SiteConfig) {\n  const successCount = results.filter(item => item.status === 'success') as TaskResultSuccess[]\n  const skippedCount = results.filter(item => item.status === 'skipped') as TaskResultSkipped[]\n  const erroredCount = results.filter(item => item.status === 'errored') as TaskResultErrored[]\n\n  const stats = `${green(`${successCount.length} generated`)}, ${yellow(`${skippedCount.length} skipped`)}, ${red(`${erroredCount.length} errored`)}`\n  const skippedList = ` - ${yellow('Following files were skipped')}:\\n\\n${skippedCount.map((item) => {\n        return gray(`    - ${relative(siteConfig.root, item.filePath)}: ${item.reason}`)\n      }).join('\\n')}`\n  const erroredList = ` - ${red('Following files encountered errors')}\\n\\n${erroredCount.map((item) => {\n        return gray(`    - ${relative(siteConfig.root, item.filePath)}: ${item.reason}`)\n      }).join('\\n')}`\n\n  const overallResults = [stats]\n\n  if (skippedCount.length > 0)\n    overallResults.push(skippedList)\n  if (erroredCount.length > 0)\n    overallResults.push(erroredList)\n\n  return overallResults.join('\\n\\n')\n}\n","import regexCreator from 'emoji-regex'\n\nconst emojiRegex = regexCreator()\n\nexport function removeEmoji(str: string) {\n  return str.replace(emojiRegex, '')\n}\n","// miketheprogrammer/xml-escape: Escape XML in javascript (NodeJS)\n// https://github.com/miketheprogrammer/xml-escape\n\nconst escapeMap: Record<string, string> = {\n  '<': '&lt;',\n  '>': '&gt;',\n  '\\'': '&apos;',\n  '\"': '&quot;',\n  '&': '&amp;',\n}\n\nexport function escape(content: string, ignore?: string): string {\n  ignore = (ignore || '').replace(/[^&\"<>\\']/g, '')\n  const pattern = '([&\"<>\\'])'.replace(new RegExp(`[${ignore}]`, 'g'), '')\n\n  return content.replace(new RegExp(pattern, 'g'), (_, item) => {\n    return escapeMap[item]\n  })\n}\n","import type { Buffer } from 'node:buffer'\nimport { Resvg } from '@resvg/resvg-js'\n\nimport { removeEmoji } from '../emoji'\nimport { escape } from './escape'\n\nexport function templateSVG(siteName: string, siteDescription: string, title: string, category: string, ogTemplate: string): string {\n  // Remove emoji and split lines\n  const lines = removeEmoji(title)\n    .trim()\n    .replace(/(?![^\\n]{1,17}$)([^\\n]{1,17})\\s/g, '$1\\n')\n    .split('\\n')\n\n  // Restricted 17 words per line\n  lines.forEach((val, i) => {\n    if (val.length > 17) {\n      lines[i] = val.slice(0, 17)\n      lines[i + 1] = `${val.slice(17)}${lines[i + 1] || ''}`\n    }\n    lines[i] = lines[i].trim()\n  })\n\n  const categoryStr = category ? removeEmoji(category).trim() : ''\n\n  const data = {\n    siteName,\n    siteDescription,\n    category: categoryStr,\n    line1: lines[0] || '',\n    line2: lines[1] || '',\n    line3: `${lines[2] || ''}${lines[3] ? '...' : ''}`,\n  }\n\n  return ogTemplate.replace(/\\{\\{([^}]+)}}/g, (_, name) => {\n    if (!name || typeof name !== 'string' || !(name in data))\n      return ''\n\n    const nameKeyOf = name as keyof typeof data\n    return escape(data[nameKeyOf])\n  })\n}\n\nexport async function renderSVG(svgContent: string, options?: { fontPath?: string }): Promise<Buffer> {\n  let resvg: Resvg\n\n  try {\n    resvg = new Resvg(svgContent, {\n      fitTo: { mode: 'width', value: 1200 },\n      font: {\n        fontFiles: options?.fontPath ? [options.fontPath] : [],\n        // Load system fonts might cost more time\n        loadSystemFonts: false,\n      },\n    })\n  }\n  catch (err) {\n    throw new Error(`Failed to initiate Resvg instance to render open graph images due to ${err}`)\n  }\n\n  try {\n    return resvg.render().asPng()\n  }\n  catch (err) {\n    throw new Error(`Failed to render open graph images on path due to ${err}`)\n  }\n}\n","import { basename, dirname, join, relative, resolve, sep } from 'node:path'\nimport { sep as posixSep } from 'node:path/posix'\nimport { fileURLToPath } from 'node:url'\nimport type { Buffer } from 'node:buffer'\nimport fs from 'fs-extra'\nimport { glob } from 'glob'\nimport type { DefaultTheme, SiteConfig } from 'vitepress'\nimport { cyan, gray, green, red, yellow } from 'colorette'\nimport GrayMatter from 'gray-matter'\nimport { unified } from 'unified'\nimport RehypeMeta from 'rehype-meta'\nimport RehypeParse from 'rehype-parse'\nimport RehypeStringify from 'rehype-stringify'\n\nimport { flattenSidebar, getSidebar } from './utils/vitepress/sidebar'\nimport { type TaskResult, renderTaskResultsSummary, task } from './utils/task'\nimport type { PageItem } from './types'\nimport { getDescriptionWithLocales, getTitleWithLocales } from './utils/vitepress/locales'\nimport { renderSVG, templateSVG } from './utils/svg/render'\n\nconst logModulePrefix = `${cyan(`@nolebase/vitepress-plugin-og-image`)}${gray(':')}`\n\nasync function tryToLocateTemplateSVGFile(siteConfig: SiteConfig): Promise<string | undefined> {\n  const templateSvgPathUnderPublicDir = resolve(siteConfig.root, 'public', 'og-template.svg')\n  if (await fs.pathExists(templateSvgPathUnderPublicDir))\n    return templateSvgPathUnderPublicDir\n\n  const __dirname = dirname(fileURLToPath(import.meta.url))\n  const templateSvgPathUnderRootDir = resolve(__dirname, 'assets', 'og-template.svg')\n  if (await fs.pathExists(templateSvgPathUnderRootDir))\n    return templateSvgPathUnderRootDir\n\n  return undefined\n}\n\nasync function tryToLocateFontFile(siteConfig: SiteConfig): Promise<string | undefined> {\n  const fontPathUnderPublicDir = resolve(siteConfig.root, 'public', 'SourceHanSansSC.otf')\n  if (await fs.pathExists(fontPathUnderPublicDir))\n    return fontPathUnderPublicDir\n\n  const __dirname = dirname(fileURLToPath(import.meta.url))\n  const fontPathUnderRootDir = resolve(__dirname, 'assets', 'SourceHanSansSC.otf')\n  if (await fs.pathExists(fontPathUnderRootDir))\n    return fontPathUnderRootDir\n\n  return undefined\n}\n\n/**\n * Render SVG and rewrite HTML\n *\n * Will always save the rendered Open Graph image as PNG under the same directory as the HTML file with\n * the name `og-${fileName of rendered HTML}.png`.\n *\n * @param {SiteConfig} siteConfig - Site configuration\n * @param {string} siteTitle - Site title\n * @param {string} siteDescription - Site description\n * @param {PageItem} page - Page item\n * @param {string} file - File path\n * @param {string} ogImageTemplateSvg - Open Graph image template SVG\n * @param {string} ogImageTemplateSvgPath - Open Graph image template SVG path\n * @param {string} domain - Domain\n * @returns {Promise<TaskResult>} Task result\n */\nasync function renderSVGAndRewriteHTML(\n  siteConfig: SiteConfig,\n  siteTitle: string,\n  siteDescription: string,\n  page: PageItem,\n  file: string,\n  ogImageTemplateSvg: string,\n  ogImageTemplateSvgPath: string,\n  domain: string,\n): Promise<TaskResult> {\n  const fileName = basename(file, '.html')\n  const ogImageFilePathBaseName = `og-${fileName}.png`\n  const ogImageFilePathFullName = `${dirname(file)}/${ogImageFilePathBaseName}`\n\n  const templatedOgImageSvg = templateSVG(\n    siteTitle,\n    siteDescription,\n    page.title,\n    page.category ?? '',\n    ogImageTemplateSvg,\n  )\n\n  try {\n    await renderSVGAndSavePNG(\n      templatedOgImageSvg,\n      ogImageFilePathFullName,\n      ogImageTemplateSvgPath,\n      relative(siteConfig.root, file),\n      { fontPath: await tryToLocateFontFile(siteConfig) },\n    )\n  }\n  catch (err) {\n    return {\n      filePath: file,\n      status: 'errored',\n      reason: String(err),\n    }\n  }\n\n  const html = await fs.readFile(file, 'utf-8')\n\n  const result = await unified()\n    .use(RehypeParse)\n    .use(RehypeMeta, {\n      og: true,\n      twitter: true,\n      name: siteTitle,\n      description: siteDescription,\n      image: {\n        url: `${domain}/${encodeURIComponent(relative(siteConfig.outDir, ogImageFilePathFullName))}`,\n      },\n    })\n    .use(RehypeStringify)\n    .process(html)\n\n  try {\n    await fs.writeFile(file, String(result), 'utf-8')\n  }\n  catch (err) {\n    console.error(\n      `${logModulePrefix} `,\n      `${red('[ERROR] ✗')} failed to write transformed HTML on path [${relative(siteConfig.root, file)}] due to ${err}`,\n      `\\n${red((err as Error).message)}\\n${gray(String((err as Error).stack))}`,\n    )\n    return {\n      filePath: file,\n      status: 'errored',\n      reason: String(err),\n    }\n  }\n\n  return {\n    filePath: file,\n    status: 'success',\n  }\n}\n\nasync function renderSVGAndSavePNG(\n  svgContent: string,\n  saveAs: string,\n  forSvgSource: string,\n  forFile: string,\n  options: {\n    fontPath?: string\n  },\n) {\n  let pngBuffer: Buffer\n\n  try {\n    pngBuffer = await renderSVG(svgContent, { fontPath: options.fontPath })\n  }\n  catch (err) {\n    console.error(\n      `${logModulePrefix} `,\n      `${red('[ERROR] ✗')} failed to generate open graph image as ${green(`[${saveAs}]`)} with ${green(`[${forSvgSource}]`)} due to ${red(String(err))}`,\n      `skipped open graph image generation for ${green(`[${forFile}]`)}`,\n      `\\n\\nSVG Content:\\n\\n${svgContent}`,\n      `\\n\\nDetailed stack information bellow:\\n\\n${red((err as Error).message)}\\n${gray(String((err as Error).stack))}`,\n    )\n\n    throw err\n  }\n\n  try {\n    await fs.writeFile(saveAs, pngBuffer, 'binary')\n  }\n  catch (err) {\n    console.error(\n      `${logModulePrefix} `,\n      `${red('[ERROR] ✗')} open graph image rendered successfully, but failed to write generated open graph image on path [${saveAs}] due to ${err}`,\n      `\\n${red((err as Error).message)}\\n${gray(String((err as Error).stack))}`,\n    )\n\n    throw err\n  }\n}\n\nexport interface BuildEndGenerateOpenGraphImagesOptions {\n  /**\n   * The base URL to use for open graph image.\n   *\n   * Must be a full URL, e.g. `https://example.com` or `https://example.com/path/of/baseUrl`.\n   *\n   * This is because for platforms like Telegram, Twitter, and Facebook, they wouldn't accept\n   * relative URLs for open graph image when dynamically fetching the image from the HTML meta tag.\n   * Instead, they require a full URL to the image.\n   *\n   * If you would ever need to use a dynamic base URL (e.g. Cloudflare Pages, Vercel, Netlify staging\n   * preview URL), you may need to create a separate stabled sub-domain or use a standalone services\n   * S3 to host the generated open graph images to make sure the image URL is full with domain.\n   */\n  baseUrl: string\n  /**\n   * The category options to use for open graph image.\n   */\n  category?: BuildEndGenerateOpenGraphImagesOptionsCategory\n}\n\nexport interface BuildEndGenerateOpenGraphImagesOptionsCategory {\n  /**\n   * Automatically extract category text from path with a specific level.\n   *\n   * For example, if you have a path like `/foo/bar/baz/index.md`, and you set `byLevel` to `1`,\n   * the category text will be `bar`. This is extremely useful when you have a file based routing,\n   * while having all the contents organized in a stable directory structure (e.g. knowledge base).\n   *\n   * As end user, either specify one of `byLevel`, `byPathPrefix`, or `byCustomGetter`, if multiple\n   * options are provided, `byCustomGetter` would be used as the first priority. `byPathPrefix` secondary,\n   * and `byLevel` as the last resort. If none of them are provided or produced undefined result for category\n   * text, it will fallback to frontmatter category text.\n   */\n  byLevel?: number\n  /**\n   * Automatically extract category text from path with a specific prefix.\n   *\n   * For example, if you have a path like `/foo/bar/baz/index.md`, and you set `byPathPrefix` to `[{ prefix: 'foo', text: 'Foo' }]`,\n   * the category text will be `Foo`. This is extremely useful when you use file based routing, while organized the contents\n   * inside a directory name that friendly to browsers.\n   *\n   * As end user, either specify one of `byLevel`, `byPathPrefix`, or `byCustomGetter`, if multiple\n   * options are provided, `byCustomGetter` would be used as the first priority. `byPathPrefix` secondary,\n   * and `byLevel` as the last resort. If none of them are provided or produced undefined result for category\n   * text, it will fallback to frontmatter category text.\n   */\n  byPathPrefix?: {\n    /**\n     * The prefix to match.\n     */\n    prefix: string\n    /**\n     * The text to use as category.\n     */\n    text: string\n  }[]\n  /**\n   * If `byLevel` or `byPathPrefix` is not enough, you can provide a custom getter to extract category text programmatically.\n   *\n   * For example you have a complex i18n system, or you want to extract category text from a specific field in frontmatter.\n   *\n   * As end user, either specify one of `byLevel`, `byPathPrefix`, or `byCustomGetter`, if multiple\n   * options are provided, `byCustomGetter` would be used as the first priority. `byPathPrefix` secondary,\n   * and `byLevel` as the last resort. If none of them are provided or produced undefined result for category\n   * text, it will fallback to frontmatter category text.\n   *\n   * @param {PageItem} page - The page item to process\n   * @returns {string} The category text\n   */\n  byCustomGetter?: (page: PageItem) => string | undefined | Promise<string | undefined>\n  /**\n   * Fallback to frontmatter category text when no category text found.\n   *\n   * Only effective when no category text found from `byLevel`, `byPathPrefix`, or `byCustomGetter`, or none of them\n   * were provided. If `true`, it will fallback to frontmatter category text when no category text found. Otherwise a 'Un-categorized'\n   * will be used as category text.\n   *\n   * @default true\n   */\n  fallbackWithFrontmatter?: boolean\n}\n\nasync function applyCategoryText(pageItem: PageItem, categoryOptions?: BuildEndGenerateOpenGraphImagesOptionsCategory): Promise<string | undefined> {\n  if (typeof categoryOptions?.byCustomGetter !== 'undefined') {\n    const gotTextMaybePromise = categoryOptions.byCustomGetter({ ...pageItem })\n\n    if (typeof gotTextMaybePromise === 'undefined')\n      return undefined\n\n    if (gotTextMaybePromise instanceof Promise)\n      return await gotTextMaybePromise\n\n    if (gotTextMaybePromise)\n      return gotTextMaybePromise\n\n    return undefined\n  }\n\n  if (typeof categoryOptions?.byPathPrefix !== 'undefined') {\n    for (const { prefix, text } of categoryOptions.byPathPrefix) {\n      if (pageItem.normalizedSourceFilePath.startsWith(prefix)) {\n        if (!text) {\n          console.warn(\n            `${logModulePrefix} ${yellow('[WARN]')} empty text for prefix ${prefix} when processing ${pageItem.sourceFilePath} with categoryOptions.byPathPrefix, will ignore...`,\n          )\n          return undefined\n        }\n\n        return text\n      }\n      if (pageItem.normalizedSourceFilePath.startsWith(`/${prefix}`)) {\n        if (!text) {\n          console.warn(\n            `${logModulePrefix} ${yellow('[WARN]')} empty text for prefix ${prefix} when processing ${pageItem.sourceFilePath} with categoryOptions.byPathPrefix, will ignore...`,\n          )\n          return undefined\n        }\n\n        return text\n      }\n    }\n\n    console.warn(\n      `${logModulePrefix} ${yellow('[WARN]')} no path prefix matched for ${pageItem.sourceFilePath} with categoryOptions.byPathPrefix, will ignore...`,\n    )\n    return undefined\n  }\n\n  if (typeof categoryOptions?.byLevel !== 'undefined') {\n    const level = Number.parseInt(String(categoryOptions?.byLevel ?? 0))\n    if (Number.isNaN(level)) {\n      console.warn(\n        `${logModulePrefix} ${yellow('[ERROR]')} byLevel must be a number, but got ${categoryOptions.byLevel} instead when processing ${pageItem.sourceFilePath} with categoryOptions.byLevel, will ignore...`,\n      )\n      return undefined\n    }\n\n    const dirs = pageItem.sourceFilePath.split(sep)\n    if (dirs.length > level)\n      return dirs[level]\n\n    console.warn(`${logModulePrefix} ${red(`[ERROR] byLevel is out of range for ${pageItem.sourceFilePath} with categoryOptions.byLevel.`)} will ignore...`)\n    return undefined\n  }\n\n  return undefined\n}\n\nasync function applyCategoryTextWithFallback(pageItem: PageItem, categoryOptions?: BuildEndGenerateOpenGraphImagesOptionsCategory): Promise<string> {\n  const customText = await applyCategoryText(pageItem, categoryOptions)\n  if (customText)\n    return customText\n\n  const fallbackWithFrontmatter = typeof categoryOptions?.fallbackWithFrontmatter === 'undefined'\n    ? true\n    : categoryOptions.fallbackWithFrontmatter\n\n  if (fallbackWithFrontmatter\n    && 'category' in pageItem.frontmatter\n    && pageItem.frontmatter.category\n    && typeof pageItem.frontmatter.category === 'string'\n  )\n    return (pageItem.frontmatter as { category?: string }).category ?? ''\n\n  console.warn(`${logModulePrefix} ${yellow('[WARN]')} no category text found for ${pageItem.sourceFilePath} with categoryOptions ${JSON.stringify(categoryOptions)}.}`)\n  return 'Un-categorized'\n}\n\n/**\n * Build end generate open graph images.\n * @param {BuildEndGenerateOpenGraphImagesOptions} options - Options used for generating open graph images.\n * @returns Build end hook for VitePress\n */\nexport function buildEndGenerateOpenGraphImages(options: BuildEndGenerateOpenGraphImagesOptions) {\n  return async (siteConfig: SiteConfig) => {\n    const ogImageTemplateSvgPath = await tryToLocateTemplateSVGFile(siteConfig)\n\n    await task('rendering open graph images', async (): Promise<string | undefined> => {\n      const themeConfig = siteConfig.site.themeConfig as unknown as DefaultTheme.Config\n      const sidebar = getSidebar(siteConfig.site, themeConfig)\n\n      // Flatten sidebar\n      let pages: PageItem[] = []\n\n      for (const locale of sidebar.locales) {\n        const flattenedSidebar = flattenSidebar(sidebar.sidebar[locale])\n        const items: PageItem[] = []\n\n        for (const item of flattenedSidebar) {\n          const relativeLink = item.link ?? ''\n          const sourceFilePath = relativeLink.endsWith('/')\n            ? `${relativeLink}index.md`\n            : `${relativeLink}.md`\n\n          const sourceFileContent = fs.readFileSync(`${join(siteConfig.root, sourceFilePath)}`, 'utf-8')\n          const { data } = GrayMatter(sourceFileContent)\n          const res: PageItem = {\n            ...item,\n            title: item.text ?? (item as any).title ?? 'Untitled',\n            category: '',\n            locale,\n            frontmatter: data,\n            sourceFilePath,\n            normalizedSourceFilePath: sourceFilePath.split(sep).join(posixSep),\n          }\n\n          res.category = await applyCategoryTextWithFallback(res, options.category)\n\n          items.push(res)\n        }\n\n        pages = pages.concat(items)\n      }\n\n      const files = await glob(`${siteConfig.outDir}/**/*.html`, { nodir: true })\n\n      if (!ogImageTemplateSvgPath) {\n        return ''\n          + `${green(`${0} generated`)}, `\n          + `${yellow(`${files.length} (all) skipped`)}, `\n          + `${red(`${0} errored`)}.`\n          + `\\n\\n`\n          + ` - ${red('Failed to locate')} og-template.svg ${red('under public or plugin directory')}, did you forget to put it? will skip open graph image generation.`\n      }\n\n      const ogImageTemplateSvg = fs.readFileSync(ogImageTemplateSvgPath, 'utf-8')\n      const generatedForFiles = await Promise.all(files.map(async (file): Promise<TaskResult> => {\n        const relativePath = relative(siteConfig.outDir, file)\n\n        const link = `/${\n          relativePath\n          .slice(0, relativePath.lastIndexOf('.'))\n          .replaceAll(sep, '/')\n        }`.split('/index')[0]\n\n        const page = pages.find((item) => {\n          if (item.link === link)\n            return true\n\n          if (item.link === `${link}/`)\n            return true\n\n          return false\n        })\n        if (!page) {\n          return {\n            filePath: file,\n            status: 'skipped',\n            reason: 'correspond Markdown page not found in sidebar',\n          }\n        }\n\n        const siteTitle = getTitleWithLocales(siteConfig.site, page.locale)\n        const siteDescription = getDescriptionWithLocales(siteConfig.site, page.locale)\n\n        return await renderSVGAndRewriteHTML(\n          siteConfig,\n          siteTitle,\n          siteDescription,\n          page,\n          file,\n          ogImageTemplateSvg,\n          ogImageTemplateSvgPath,\n          options.baseUrl,\n        )\n      }))\n\n      return renderTaskResultsSummary(generatedForFiles, siteConfig)\n    })\n  }\n}\n"],"names":["task","posixSep"],"mappings":"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"}